//////////////////////////////////////////////////////////////////////////////
// INCLUDES
//////////////////////////////////////////////////////////////////////////////
#include <stddef.h>
#include "CuTest.h"
#include "apx_serverConnection.h"
#include "apx_server.h"
#include "testsocket.h"
#ifdef MEM_LEAK_CHECK
#include "CMemLeak.h"
#endif


//////////////////////////////////////////////////////////////////////////////
// CONSTANTS AND DATA TYPES
//////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////
// LOCAL FUNCTION PROTOTYPES
//////////////////////////////////////////////////////////////////////////////
static void test_apx_serverConnection_create(CuTest* tc);

//////////////////////////////////////////////////////////////////////////////
// GLOBAL VARIABLES
//////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////
// LOCAL VARIABLES
//////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////
// GLOBAL FUNCTIONS
//////////////////////////////////////////////////////////////////////////////


CuSuite* testSuite_apx_serverConnection(void)
{
   CuSuite* suite = CuSuiteNew();
   SUITE_ADD_TEST(suite, test_apx_serverConnection_create);
   return suite;
}

//////////////////////////////////////////////////////////////////////////////
// LOCAL FUNCTIONS
//////////////////////////////////////////////////////////////////////////////
static void test_apx_serverConnection_create(CuTest* tc)
{
   apx_serverConnection_t conn;
   testsocket_t *sock1, *sock2;
   sock1 = testsocket_new(); //apx_serverConnection_t takes ownership of this object. No need to manually delete it
   sock2 = testsocket_new();
   CuAssertIntEquals(tc, 0, apx_serverConnection_create(&conn, 0, sock1, NULL));
   CuAssertUIntEquals(tc, 0, conn.connectionId);
   CuAssertPtrEquals(tc, sock1, conn.socketObject);
   apx_serverConnection_destroy(&conn);
   CuAssertIntEquals(tc, 0, apx_serverConnection_create(&conn, 1, sock2, NULL));
   CuAssertUIntEquals(tc, 1, conn.connectionId);
   CuAssertPtrEquals(tc, sock2, conn.socketObject);
   apx_serverConnection_destroy(&conn);
}



